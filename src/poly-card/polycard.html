<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="poly-card">
	<template>
		<style>
			:host {
				display: block;
			}

			#container {
				display: inline-block;
				background-color: #fff;
				box-shadow: 0 2px 2px #ccc;
				font-size: 20px;
				min-width: 350px;
				position: relative;
			}

			@media screen and (max-width: 800px) {
				#container {
					width: 100%;
				}
			}

			#content {
				display: flex;
				align-items: stretch;
				margin: 20px 20px 10px;
			}

			#sold-out-overlay {
				opacity: 0;
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				pointer-events: none;
				transition: opacity .5s;
				background-color: rgba(0, 0, 0, .75);
				color: #ffffff;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			#sold-out-overlay span {
				font-size: 24px;
				text-transform: uppercase;
				transform: rotateZ(-25deg);
				display: block;
			}

			#sold-out-overlay.show {
				opacity: 1;
				pointer-events: auto;
			}

			#pie-image {
				display: inline-block;
			}

			#pie-image img {
				width: 100px;
				height: 100px;
				border-radius: 50%;
				margin-right: 5px;
			}

			#pie-name {
				font-family: 'Roboto Slab', sans-serif;
				font-size: 24px;
			}

			#pie-name a, #pie-name a:active, #pie-name a:visited {
				text-decoration: underline;
				color: #000;
			}

			#pie-info {
				padding-left: 10px;
				flex: 1 0;
			}

			#pie-info div + * {
				margin-top: 5px;

			}


			.info {
				display: flex;
				flex-flow: row nowrap;
				justify-content: space-between;
				align-items: center;
				font-size: 16px;
			}

			.info .label {
				text-transform: uppercase;
				font-size: 14px;
			}

			#purchase {
				display: block;
				margin: 0;
				padding: 0;
				width: 100%;
				background-color: #ff6a00;
				border: 0;
				color: #fff;
				padding: 14px;
				font-size: 12px;
				text-transform: uppercase;
				cursor: pointer;
			}

			#purchase[disabled] {
				cursor: not-allowed;
				background-color: #ccc;
			}

		</style>

		<div id="container">
			<div id="sold-out-overlay" class$="{{getClass(shouldDisable)}}">
				<span>Sold Out</span>
			</div>
			<div id="content">
				<div id="pie-image">
					<img src$="[[pie.imageUrl]]" alt="">
				</div>
				<div id="pie-info">
					<div id="pie-name"><a href="#" on-tap="gotoPie">[[pie.name]]</a></div>
					<div class="price info">
						<span class="label">Price: </span>
						$[[pie.price]]
					</div>
					<div class="remaining info">
						<span class="label">Remaining: </span>
						[[pie.slices]]
					</div>
				</div>
			</div>
			<button type="button" id="purchase" disabled$="[[shouldDisable]]">Buy a slice!</button>
		</div>
	</template>
	<script>
		var appRouter = document.querySelector('app-router');
		Polymer({
			is: 'poly-card',
			properties: {
				pie: Object,
				shouldDisable: {
					type: Boolean,
					computed: 'detectShouldDisable(pie.slices)'
				}
			},
			listeners: {
				'purchase.tap': 'purchase'
			},
			purchase: function() {
				this.fire('onPurchase', {pie: this.pie});
			},
			getClass: function(disabled) {
				if (disabled) return 'show';
			},
			detectShouldDisable: function(slices) {
				return slices === 0;
			},
			gotoPie: function(e) {
				e.preventDefault();
				e.stopPropagation();
				appRouter.go('/pies/' + this.pie.id);
			}
		});
	</script>
</dom-module>
